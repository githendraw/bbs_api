<!DOCTYPE html>
<html>
<head>
    <title>Print Resi</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/paper-css/0.3.0/paper.css">
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @page {
            size: A4;
            margin: 3mm;
        }

        @media print {
            @page {
                size: A4;
                margin: 3mm;
            }
        }

        body {
            font-family: Arial, sans-serif;
            font-size: 8pt;
            color: #000;
        }

        .page-container {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 1mm;
        }

        .receipt {
            border: 2px solid #000;
            padding: 1.5mm;
            page-break-inside: avoid;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 7pt;
        }

        table td, table th {
            border: 1px solid #000;
            padding: 1px 2px;
            vertical-align: middle;
        }

        .no-border td, .no-border th {
            border: none;
        }

        .label {
            font-weight: bold;
        }

        .text-center {
            text-align: center;
        }

        .logo-img {
            width: 30px;
            height: 30px;
        }

        .company-title {
            font-size: 9pt;
            font-weight: bold;
            text-align: center;
        }

        .company-subtitle {
            font-size: 7pt;
            text-align: center;
            line-height: 1.1;
        }

        .company-address {
            font-size: 6pt;
            text-align: center;
            line-height: 1;
        }

        .signature-box {
            height: 20px;
            border: 1px solid #000;
            margin-top: 1px;
        }

        .qrcode-container {
            text-align: center;
        }

        .total-row {
            background-color: #ddd;
            font-weight: bold;
        }

        .remarks-section {
            border: 1px solid #000;
            padding: 2px;
            font-size: 7pt;
            font-weight: bold;
            text-align: center;
            background-color: #ffffcc;
        }

        .footer-info {
            font-size: 6pt;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="page-container">
        <% for(var j=0; j < 3; j++) {%>
        <div class="receipt">
            <!-- Header -->
            <table class="no-border" style="margin-bottom: 1px;">
                <tr>
                    <td style="width: 15%;" class="text-center">
                        <img class="logo-img" src="data:image/png;base64,<%=img%>">
                    </td>
                    <td style="width: 55%;">
                        <div class="company-title">PAKET EXPRESS</div>
                        <div class="company-subtitle">CARGO DAN LOGISTICS SERVICES</div>
                        <div class="company-subtitle">KE SELURUH INDONESIA (DARAT, LAUT, UDARA)</div>
                        <div class="company-subtitle">Jemput Antar Alamat (Door to Door)</div>
                        <div class="company-address"><%=company.address1%></div>
                        <div class="company-address">WA Center: <%=company.phone_1%></div>
                        <div class="company-address">Email: <%=company.email%><% if (company.website) { %> | Website: <%=company.website%><% } %></div>
                    </td>
                    <td style="width: 30%;" class="text-center">
                        <div style="font-size: 9pt; font-weight: bold; color: #000;">ISI TIDAK DIPERIKSA</div>
                    </td>
                </tr>
            </table>

            <!-- Main Details Table -->
            <table style="margin-bottom: 1px;">
                <tr>
                    <td class="label">No.Airwaybill</td>
                    <td><%=shipment.shipment_awbm%></td>
                    <td class="label">Asal</td>
                    <td><%=shipment.originname%></td>
                    <td class="label">Tujuan</td>
                    <td><%=shipment.destinationname%></td>
                    <td class="label">Koli</td>
                    <td style="width: 7%;"><%=shipment.qty%></td>
                    <td class="label">Berat</td>
                    <td style="width: 8%;"><%=shipment.weight_actual%> <%=shipment.uom_id%></td>
                    <td class="label">Volume</td>
                    <td style="width: 8%;"><%=shipment.weight_vol%> <%=shipment.uom_id%></td>
                </tr>
            </table>

            <!-- Pengirim & Penerima Info -->
            <table style="margin-bottom: 1px;">
                <tr>
                    <td style="width: 10%;" class="label">Pelanggan</td>
                    <td colspan="5"><%=shipment.partner_name%></td>
                    <td style="width: 12%;" class="label">Penerima</td>
                    <td colspan="5"><%=shipment.receiver_name%></td>
                </tr>
                <tr>
                    <td class="label">Telp</td>
                    <td colspan="5"><%=shipment.partner_phone1%></td>
                    <td class="label">Telp</td>
                    <td colspan="5"><%=shipment.receiver_phone1%></td>
                </tr>
                <tr>
                    <td class="label">Alamat</td>
                    <td colspan="5"><%=shipment.partner_address1%></td>
                    <td class="label">Alamat</td>
                    <td colspan="5"><%=shipment.receiver_address1%></td>
                </tr>
            </table>

            <!-- Service & Payment Info -->
            <table style="margin-bottom: 1px;">
                <tr>
                    <td style="width: 15%;" class="label">Jenis Kiriman</td>
                    <td style="width: 18%;"><%=shipment.shipment_type_id || 'DARAT'%></td>
                    <td style="width: 15%;" class="label">Kiriman Via</td>
                    <td style="width: 18%;"><%=shipment.service_id%></td>
                    <td style="width: 10%;" class="label">Tanggal</td>
                    <td style="width: 24%;"><%=moment(shipment.shipment_date).format('DD-MM-YYYY')%></td>
                </tr>
                <tr>
                    <td class="label">Barang</td>
                    <td colspan="5"><%=shipment.itemdesc%></td>
                </tr>
            </table>

            <!-- Cost Breakdown -->
            <table style="margin-bottom: 1px;">
                <tr>
                    <td style="width: 30%;" class="label">Biaya Kirim</td>
                    <td style="width: 20%;">Rp <%=currencyFormatter.format(shipment.charge, {code: 'IDR'}).replace('Rp', '')%></td>
                    <% if (shipment.tax_amount > 0) { %>
                    <td style="width: 30%;" class="label">PPh 23</td>
                    <td style="width: 20%;">(Rp <%=currencyFormatter.format(shipment.tax_amount, {code: 'IDR'}).replace('Rp', '')%>)</td>
                    <% } else { %>
                    <td style="width: 30%;" class="label">Biaya Lain-lain</td>
                    <td style="width: 20%;">Rp <%=currencyFormatter.format(shipment.pickup_charge || 0, {code: 'IDR'}).replace('Rp', '')%></td>
                    <% } %>
                </tr>
                <tr>
                    <td class="label">Biaya Asuransi</td>
                    <td>Rp <%=currencyFormatter.format(shipment.insurance || 0, {code: 'IDR'}).replace('Rp', '')%></td>
                    <td class="label">Biaya Admin</td>
                    <td>Rp <%=currencyFormatter.format(shipment.packing_charge || 0, {code: 'IDR'}).replace('Rp', '')%></td>
                </tr>
                <tr class="total-row">
                    <td class="label">Total</td>
                    <td>Rp <%=currencyFormatter.format(shipment.total, {code: 'IDR'}).replace('Rp', '')%></td>
                    <td class="label">Cara Bayar</td>
                    <td><%=shipment.payment_type || 'TRANSFER'%></td>
                </tr>
            </table>

            <!-- Remarks -->
            <div class="remarks-section" style="margin-bottom: 1px;">
                <%=shipment.specialinst || 'TANPA ASURANSI'%><br>
                TLG JGN DIBANTING/DITINDIH BARANG BERAT
            </div>

            <!-- Footer with Signature -->
            <table style="margin-bottom: 1px;">
                <tr>
                    <td style="width: 30%;" class="text-center">
                        <div style="font-size: 7pt;">Tanda Tangan Pengirim</div>
                        <div class="signature-box"></div>
                    </td>
                    <td style="width: 5%;"></td>
                    <td style="width: 30%;" class="text-center">
                        <div style="font-size: 7pt;">Tanda Tangan Petugas</div>
                        <div class="signature-box"></div>
                        <div style="font-size: 6pt; margin-top: 1px;"><%=shipment.pickup_by%></div>
                    </td>
                    <td style="width: 35%;" class="text-center">
                        <div style="font-size: 7pt;">Tanda tangan dan Stempel</div>
                        <div class="signature-box" style="width: 80px; margin: 1px auto;"></div>
                    </td>
                </tr>
            </table>

            <!-- Bottom Section -->
            <table class="no-border" style="margin-bottom: 1px;">
                <tr>
                    <td style="width: 50%;" class="text-center">
                        <div style="font-size: 7pt;">Nama</div>
                        <div class="signature-box" style="width: 100px; margin: 0 auto;"></div>
                    </td>
                    <td style="width: 20%;" class="text-center">
                        <div style="font-size: 7pt;">Tanggal</div>
                        <div class="signature-box" style="width: 60px; margin: 0 auto;"></div>
                    </td>
                    <td style="width: 30%;" class="qrcode-container">
                        <div id="qrcode-<%=j%>" style="display: inline-block;"></div>
                    </td>
                </tr>
            </table>

            <!-- Disclaimer & Footer Info -->
            <table class="no-border">
                <tr>
                    <td style="width: 70%;" class="text-center">
                        <div style="font-size: 7pt; font-weight: bold;">Kiriman ini sudah saya / kami terima dengan baik dan benar</div>
                        <div style="font-size: 6pt; margin-top: 1px;">Pengirim menyatakan bahwa semua informasi pada Surat Tanda Terima Titipan adalah BENAR dan NERIMA seluruh syarat pengiriman.</div>
                    </td>
                    <td style="width: 30%;" class="text-center">
                        <div style="font-size: 7pt;">Jam</div>
                        <div class="signature-box" style="width: 60px; margin: 0 auto;"></div>
                    </td>
                </tr>
            </table>

            <!-- Print Info -->
            <div style="display: flex; justify-content: space-between; margin-top: 1px;" class="footer-info">
                <span>Print on: <%=moment().format('DD-MM-YYYY HH:mm')%></span>
                <span>File <%=j+1%> = <%=j === 0 ? 'PENGIRIM' : j === 1 ? 'PUKET' : 'PENERIMA'%></span>
            </div>
        </div>
        <% } %>
    </div>

    <!-- QRCode Library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

    <script>
        // Generate QR Code
        <% for(var j=0; j < 3; j++) {%>
            new QRCode(document.getElementById("qrcode-<%=j%>"), {
                text: "<%=shipment.shipment_awbm%>",
                width: 30,
                height: 30,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.M
            });
        <% } %>
    </script>
</body>
</html>
